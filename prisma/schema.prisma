generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum OrgRole {
  OWNER
  ADMIN
  MEMBER
}

enum VolunteerRole {
  GUITARIST
  PIANIST
  AUX_KEYS
  DRUMMER
  VOCALIST
  BASSIST
  SOUND_TECH
  USHER
  GREETER
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  CANCELED
}

model User {
  id        String @id @default(uuid())
  clerkId   String @unique
  email     String @unique
  firstName String
  lastName  String

  memberships Membership[]
  sentInvitations Invitation[] 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Organization {
  id          String   @id @default(uuid())
  name        String
  description String

  memberships Membership[]
  invitations Invitation[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Membership {
  id          String   @id @default(uuid())
  role OrgRole @default(MEMBER)
  volunteerRoles VolunteerRole[]

  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  organizationId String
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, organizationId])
  @@index([organizationId])
  @@index([userId])
  @@index([organizationId, role])
}

model Invitation {
  id String @id @default(uuid())
  email String 
  token String @unique @default(uuid())
  status InvitationStatus @default(PENDING)
  volunteerRoles VolunteerRole[]
  expiresAt DateTime

  invitedById String
  invitedBy User @relation(fields: [invitedById], references: [id], onDelete: Cascade)

  organizationId String
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([email, organizationId])
  @@index([token])
  @@index([email])
  @@index([organizationId])

}